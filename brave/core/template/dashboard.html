## encoding: utf-8

<%inherit file="brave.core.template.master"/>

<%block name="title">Dashboard</%block>

<%block name="header">
    ${parent.header()}
    
    <style>
        .user-profile .header span.area { color: #7d848c; font-style: italic; font-size: 14px; }
        .user-profile .header .avatar { width: 96px; height: 96px; float: left; margin-right: 25px; border: 2px solid #e9ecee; position: relative; top: 3px; border-radius: 12px; }
        .user-profile .header .name { font-weight: 600; margin: 0 0 10px; line-height: 26px; float: none; padding-top: 12px; }
        .user-profile .header .area span { margin: 0 5px; }
        #pad-wrapper.user-profile h4 { margin: 0 0 10px; font-weight: 600; font-size: 14px; font-style: normal; text-indent: 0; color: black; }
        .user-profile .profile .bio p { 
    </style>
</%block>

<%block name="post">
    ${parent.post()}

    <script type="text/javascript" charset="utf-8">
        $(function(){
            $('time').timeago();
        });
    </script>
</%block>

<div class="container-fluid">
    <div id="pad-wrapper" class="user-profile">
    % if web.user.primary:
        <div class="header">
            <img src="//image.eveonline.com/Character/${web.user.primary.identifier}_128.jpg" class="avatar">
            
            <h3 class="name">${web.user.primary.name | h}</h3>
            <span class="area">
            ${", ".join(web.user.primary.titles) | h}
            </span>
            <div class="area">
                <a target="_blank" href="https://gate.eveonline.com/Corporation/${web.user.primary.corporation.name | u}">${web.user.primary.corporation.name | h}</a>
                % if web.user.primary.alliance:
                <span>â€º</span> <a target="_blank" href="https://gate.eveonline.com/Alliance/${web.user.primary.alliance.name | u}">${web.user.primary.alliance.name | h}</a>
                % endif
            </div>
        </div>
        
        <div class="row-fluid profile">
            <div class="span7 bio" style="box-shadow: 4px 0px 3px -1px rgba(226,226,226,0.1); border-right: 1px solid #edeef1">
                <div class="profile-box" style="padding-right: 25px;">
                    <h4>Welcome</h4>
                    <p>
                        Welcome to the Of Sound Mind Core service.  This site provides a way for you to securely provide EVE API keys and manage the applications you can use Core to authenticate.
                    </p>
                    <p>
                        Use the <em>Authorized Applications</em> links on the right-hand side to quickly jump to the application of your choice.
                    </p>
                    <p>
                        The listing of <em>Authentication Attempts</em> below will list all successful and unsuccessful attempts made to log into your account.  If you notice suspicious activity please <a href="https://github.com/bravecollective/core/issues" target="_blank">open a ticket</a>.
                    </p>
                    
                    <hr>
                    
                    <h4>Authentication Attempts</h4>
                    
                    <style>.table td {  } .table thead th { padding-bottom: 5px; }</style>
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th class="span5">
                                    Date
                                </th>
                                <th class="span6">
                                    <span class="line"></span>
                                    From
                                </th>
                                <th class="span1">
                                    <span class="line"></span>
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            % for attempt in web.user.attempts.order_by('-id').limit(10):
                            <tr>
                                <td><time datetime="${attempt.id.generation_time.isoformat().replace('+00:00', 'Z')}">${attempt.id.generation_time.isoformat(' ').replace('+00:00', '')}</time></td>
                                <td>${attempt.location | h}</td>
                                % if attempt.success:
                                <td><i class="fa fa-check-circle-o fa-lg text-success"></i></td>
                                % else:
                                <td><i class="fa fa-times-circle-o fa-lg text-error"></i></td>
                                % endif
                            </tr>
                            % endfor
                        </tbody>
##                        <tfoot>
##                            <tr>
##                                <th colspan="5" style="text-align: center;"><a href="">View Full Authentication History</a></th>
##                            </tr>
##                        </tfoot>
                    </table>
        
                </div>
            </div>
        
            <!-- side address column -->
            <div class="span5 pull-right">
                <h4>Authorized Applications</h4>
                <ul>
                    % for grant in web.user.grants:
                    <li><a target="_blank" href="${grant.application.site | u}" title="${grant.application.description | u}">${grant.application.name | h}</a></li>
                    % endfor
                </ul>
                
                <hr>
                
                <h4>Group Membership</h4>
                <ul>
                    % for id, group in web.user.primary.tags.iteritems():
                    <li>${group.title | h}</li>
                    % endfor
                </ul>
            </div>
        </div>

    % endif
    </div>
</div>
